<?xml version="1.0"?>

<!--Adapted from  F-4N by Dave Culp-->

<system name="catapult">

    <channel name="Catapult">
        
        <switch name="systems/catapult/cat-cmd-norm">
            <default value="0"/>
            
            <test  logic="AND" value="0">
                systems/catapult/cat-pos-norm gt 0.999
            </test>
            <test  logic="AND" value="1">
                systems/catapult/cat-launch-cmd == 1
                gear/unit[1]/WOW == 1
                launchbar/launch-bar-state == 1
            </test>
            <output>systems/catapult/cat-launch-cmd</output>
        </switch>
        
        <kinematic name="systems/catapult/cat-timer">
            <input>systems/catapult/cat-cmd-norm</input>
            <traverse>
                <setting>
                    <position>0.0</position>
                    <time>0.0</time>
                </setting>
                <setting>
                    <position>1.0</position>
                    <time>2.7</time>
                </setting>
            </traverse>
            <output>systems/catapult/cat-pos-norm</output>
        </kinematic>
        
        <pure_gain name="systems/catapult/cat-force">
            <input>inertia/weight-lbs</input>
            <gain>3.5</gain>
        </pure_gain>
        
       
        
        
        <switch name="systems/catapult/cat-final">
            <default value="0"/>
            <test  logic="AND" value="systems/catapult/cat-force">
                systems/catapult/cat-launch-cmd == 1
                systems/catapult/cat-pos-norm lt 0.999
                systems/catapult/cat-pos-norm gt 0.0
            </test>
            <output>external_reactions/catapult/magnitude</output>
        </switch>
        
        
        
        <!-- vertical hold -->
        <!--only a guess , to animate the body when tied, and to avoid pitch during catapulting-->
        <pure_gain name="systems/cat-hold/weight">
            <input>inertia/weight-lbs</input>
            <gain>0.3</gain>
         </pure_gain>
        
        
        <switch name="systems/cat-hold/magnitudet">
            <default value="0"/>
            <test logic="OR" value="systems/cat-hold/weight">
                launchbar/launch-bar-state == 1
                systems/catapult/cat1-final gt  100
                systems/catapult/cat2-final gt  100
            </test>
            <output>external_reactions/cat-hold/magnitude</output>
         </switch>
        
    </channel>

 

</system>
