<?xml version="1.0"?>

<!--Adapted from  F-4N by Dave Culp-->

<system name="hook">

  <property>systems/hook/tailhook-cmd-norm</property>
  <property>/controls/gear/tailhook</property>

  <channel name="Hook">

      <kinematic name="Hook Control">
            <input>/controls/gear/tailhook</input>
            <traverse>
                    <setting>
                            <position>0</position>
                            <time>0</time>
                    </setting>
                    <setting>
                            <position>1</position>
                            <time>1</time>
                    </setting>
            </traverse>
            <output>/gear/tailhook/position-norm</output>
    </kinematic>

     <kinematic name="systems/hook/tailhook-control">
       <input>systems/hook/tailhook-cmd-norm</input>
       <traverse>
        <setting>
          <position> 0 </position>
          <time>     0 </time>
        </setting>
        <setting>
          <position> 1 </position>
          <time>     1.5 </time>
        </setting>
       </traverse>
       <output>systems/hook/tailhook-pos-norm</output>
     </kinematic>


<summer name="systems/wire1-lat-diff-position">
        <input>systems/wire1-lat-position</input>
        <input>-position/lat-geod-deg</input>
    </summer>

    <summer name="systems/wire1-lon-diff-position">
        <input>systems/wire1-lon-position</input>
        <input>-position/long-gc-deg</input>
    </summer>

    <summer name="systems/wire2-lat-diff-position">
        <input>systems/wire2-lat-position</input>
        <input>-position/lat-geod-deg</input>
    </summer>

    <summer name="systems/wire2-lon-diff-position">
        <input>systems/wire2-lon-position</input>
        <input>-position/long-gc-deg</input>
    </summer>

    <summer name="systems/wire3-lat-diff-position">
        <input>systems/wire3-lat-position</input>
        <input>-position/lat-geod-deg</input>
    </summer>

    <summer name="systems/wire3-lon-diff-position">
        <input>systems/wire3-lon-position</input>
        <input>-position/long-gc-deg</input>
    </summer>

    <summer name="systems/wire4-lat-diff-position">
        <input>systems/wire4-lat-position</input>
        <input>-position/lat-geod-deg</input>
    </summer>

    <summer name="systems/wire4-lon-diff-position">
        <input>systems/wire4-lon-position</input>
        <input>-position/long-gc-deg</input>
    </summer>




    <!--we estimate if we are in the area of  36 meter square -->


     <switch name="systems/hook-onarea">
          <default value="0"/>
          <test logic="AND" value="1">
               systems/wire1-lat-diff-position lt 0.000061
               systems/wire1-lat-diff-position gt -0.000061
               systems/wire1-lon-diff-position lt 0.000061
               systems/wire1-lon-diff-position gt -0.000061
          </test>
          <test logic="AND" value="1">
               systems/wire2-lat-diff-position lt 0.000061
               systems/wire2-lat-diff-position gt -0.000061
               systems/wire2-lon-diff-position lt 0.000061
               systems/wire2-lon-diff-position gt -0.000061
          </test>
          <test logic="AND" value="1">
               systems/wire3-lat-diff-position lt 0.000061
               systems/wire3-lat-diff-position gt -0.000061
               systems/wire3-lon-diff-position lt 0.000061
               systems/wire3-lon-diff-position gt -0.000061
          </test>
          <test logic="AND" value="1">
               systems/wire4-lat-diff-position lt 0.000061
               systems/wire4-lat-diff-position gt -0.000061
               systems/wire4-lon-diff-position lt 0.000061
               systems/wire4-lon-diff-position gt -0.000061
          </test>
     </switch>


     <switch name="systems/hook/ready">
          <default value="0"/>
          <test  logic="AND" value="1">
                /gear/tailhook/position-norm gt 0.99
          </test>
     </switch>

     <scheduled_gain name="systems/hook/hook-decel-multiplier">
      <input>systems/hook/ready</input>
      <table>
        <independentVar lookup="row">gear/unit[1]/wheel-speed-fps</independentVar>
         <tableData>
            0     0.00
            1     0.00
            80    4.50
         </tableData>
      </table>
     </scheduled_gain>

     <pure_gain name="systems/hook/hook-decel-force">
        <input>systems/hook/hook-decel-multiplier</input>
        <gain>inertia/weight-lbs</gain>
     </pure_gain>

     <summer name="systems/hook/force">
        <input>systems/hook/hook-decel-force</input>
        <input>systems/holdback/total_thrust</input>
     </summer>

     <switch name="systems/hook/wire-engaged">
          <default value="systems/hook/wire-engaged"/>
          <test  logic="AND" value="1">
                gear/unit[1]/WOW == 1
                velocities/ve-kts gt 3.0
                systems/hook/ready == 1
                systems/hook-onarea  == 1
          </test>
          <test  logic="AND" value="0">
                gear/unit[1]/WOW == 1
                velocities/ve-kts lt 3.0
          </test>
     </switch>


     <switch name="systems/hook/wire-reaction">
          <default value="0"/>
          <test  logic="AND" value="systems/hook/force">
                systems/hook/wire-engaged == 1
          </test>
          <output>external_reactions/hook/magnitude</output>
     </switch>

  </channel>

</system>
